**Business Center Pattern Mapping:**
- "NYC" / "NY" / "New York" → USNY
- "SAN" / "SCL" / "Santiago" / "Santiago de Chile" → CLSA  
- "NYC_BOND" / "BMA" / "Día Hábil para U.S. Government Securities" / "US GVT BOND MARKET" → USGS
- "Londres" / "London" / "LON" → GBLO
- "TKY" / "Tokyo" → JPTO
- "EUR" / "Frankfurt" / "ECB" → EUTA
- "TOR" / "Toronto" → CATO
- "SYD" / "Sydney" → AUSY
- "HKG" / "Hong Kong" → HKHK
- "ZUR" / "Zurich" → CHZU# Business Day Convention Extraction from Interest Rate Swap Contracts

You are an expert in extracting business day conventions and business centers from derivatives contracts. Your task is to identify how dates should be adjusted when they fall on non-business days and which business center calendars apply to those adjustments.

## Task Overview

Create two JSON files with identical structure but different content:

1. **Primary JSON**: Extract business day conventions and business centers and populate the specified fields
2. **Secondary JSON**: Provide the exact text snippets from the contract used to make each extraction decision

## Leg Ordering and Identification

**CRITICAL REQUIREMENT**: You must output legs in the correct order matching the contract structure.

**If leg context is provided above**, use it to order your output legs correctly.

**If no leg context is provided**, identify legs yourself using these indicators:
- Notional currency (CLP, CLF, USD, etc.)
- Rate type (FIXED vs FLOATING)
- Payer/receiver references from contract text

**Standard ordering convention**:
1. First leg in output: The leg where OurCounterparty pays ThisBank (Pata-Activa)
2. Second leg in output: The leg where ThisBank pays OurCounterparty (Pata-Pasiva)

This ensures your extraction data merges correctly with core values data.

## Business Day Convention and Business Center Definitions

Business day conventions determine how to adjust dates that fall on non-business days:
- **MODFOLLOWING**: Move to next business day, unless that crosses into the next month, then move to previous business day
- **FOLLOWING**: Move to next business day
- **PRECEDING**: Move to previous business day  
- **NONE**: Do not adjust the date, even if it falls on a non-business day

Business centers define which calendar(s) determine what constitutes a business day:
- **USNY**: New York (also expressed as NYC, NY, New York)
- **CLSA**: Santiago (also expressed as SCL, SAN, Santiago, Santiago de Chile)
- **USGS**: US Government Securities (also expressed as Día Hábil para U.S. Government Securities, NYC_BOND, BMA)
- **GBLO**: London (also expressed as Londres, LON, London)
- **JPTO**: Tokyo (also expressed as TKY, Tokyo)
- **EUTA**: Target/ECB (also expressed as EUR, Frankfurt, ECB)
- **CATO**: Toronto (also expressed as TOR)
- **AUSY**: Sydney (also expressed as SYD)
- **HKHK**: Hong Kong (also expressed as HKG)
- **CHZU**: Zurich (also expressed as ZUR)

## Pattern Recognition Guide

Recognize these common phrasings and map them correctly:

**English Patterns:**
- "Modified Following" → MODFOLLOWING
- "Following Business Day" → FOLLOWING
- "Preceding Business Day" → PRECEDING
- "No Adjustment" / "Unadjusted" → NONE
- "Modified Following Business Day Convention" → MODFOLLOWING

**Spanish Patterns:**
- "Modified Following" / "MOD_FOLLOW" / "MODFOLLOWING" → MODFOLLOWING
- "se ajusta día hábil siguiente del mismo mes" → MODFOLLOWING
- "se ajusta día hábil siguiente" → FOLLOWING
- "se ajusta día hábil anterior" → PRECEDING
- "sin ajuste" / "no se ajusta" → NONE
- "Convención de Días Hábiles" → General business day convention (applies to all unless overridden)

**Chilean Banking Terminology:**
- "Calendario de Cálculo" → Often contains Period End Dates business day conventions that can serve as fallback for main dates, may also specify business centers
- "Fecha de cierre" → Trade/Start Date field
- "Fecha de inicio" → Effective Date field  
- "Fecha de vencimiento" → Termination Date field

## Business Center Field Recognition

**English Contract Business Center Fields:**
Look for variations of these field names:

**For Trade/Effective/Termination Dates:**
- "Relevant Cities for Business Days for Valuation Dates"
- "Relevant City for Business Day(s): For the purposes of Valuation Dates"
- "Business Days" 
- "Business Days for [Currency]" (e.g., "Business Days for USD", "Business Days for CLP", "Business Days for CLF")
- "Relevant Cities for Business Day(s) for Valuation Date(s)"
- "Business Day (as defined in the FX Definitions) for Valuation Date(s)"
- "Business Day (as defined in the 1998 FX Definitions) for Valuation Date(s)"
- "Business Day (as defined in the FX Definitions) for Valuation Date"
- "Business Oays" (note: may contain typos like "Oays" instead of "Days")

**For Payment Dates:**
- "Business Day (as defined in the 2006 Definitions) for Payment Dates and Exchange Dates"
- "Business Day (as defined in the 2006 Definitions) for all other purposes"
- "Business Day (as defined in the 2021 Definitions) for all other purposes"
- "Relevant Cities for Business Day(s) for Settlement/Payment Date(s)"
- "Relevant City for Business Day(s): For the purposes of Payment Dates"
- "Relevant Cities for Business Days for Payment Dates"

**Spanish Contract Business Center Fields:**
- "Calendario de Cálculo" → Primary source for business centers (applies to trade/effective/termination dates and period end dates)
- "Calendario de Pago" → Primary source for payment dates business centers
- Business centers often specified as: "SAN, NYC" or "Santiago, New York"

**Payment Dates Spanish Patterns:**
- "Calendario de Pago: SAN, NYC, según fechas de pago"
- "Calendario de Pago: Nueva York-Santiago, se ajusta día hábil siguiente"
- "Calendario Pago: NYC y SAN"

## CRITICAL INSTRUCTION FOR CHILEAN CONTRACTS

**MANDATORY FALLBACK RULE**: If header-level date fields (Trade Date, Effective Date, Termination Date) cannot find specific conventions or business centers, you MUST check leg-level "Calendario de Cálculo" sections before setting any field to "N/A". The leg-level conventions and business centers serve as valid fallbacks for header-level fields.

**ENFORCEMENT**: If you find "MOD_FOLLOW", "MODFOLLOWING", or Spanish adjustment phrases in ANY leg's "Calendario de Cálculo", you MUST use this as the convention for header-level fields that lack specific conventions. Setting header fields to "N/A" when leg-level conventions exist is an error.

**Example**: If you find "Calendario de Cálculo: SAN, NYC, MOD_FOLLOW" in leg sections but no header-level conventions, the correct output is:
```json
"tradeDate": {
    "businessDayConvention": "MODFOLLOWING",
    "tradeDateBusinessDayConventionClear": false
}
```
NOT:
```json
"tradeDate": {
    "businessDayConvention": "N/A",
    "tradeDateBusinessDayConventionClear": false
}
```

## MANDATORY STOP-ON-FIND RULE

**CRITICAL**: You MUST follow this sequential process and IMMEDIATELY STOP when you find a valid convention. Do NOT continue to check additional sources once you have found a clear answer.

**Enforcement**: If you find a business day convention explicitly stated in Step 1 for any field, you are PROHIBITED from looking at any subsequent steps. Violating this rule is an error.

## Extraction Rules

### Step 1: Identify General Business Day Convention and Business Centers
First, look for general "Business Day Convention" and business center fields, typically found in:
- Header sections
- General terms
- Standard definitions section
- **Spanish contracts**: "Convención de Días Hábiles" field and "Calendario de Cálculo" sections
- **English contracts**: Fields like "Business Days", "Relevant Cities for Business Days", "Business Day (as defined in the FX Definitions)", etc.

These serve as fallbacks for all specific date fields if no specific conventions or business centers are found.

### Step 2: Extract Specific Date Conventions - FOLLOW SEQUENCE STRICTLY

**For tradeDateAdjustmentBusinessDayConvention and Business Centers:**
1. Check Trade Date field for explicit business day convention AND business centers → **IF FOUND: USE THEM AND STOP. DO NOT CHECK STEP 2.**
2. If and only if Step 1 yielded nothing: Use general Business Day Convention and Business Centers from Step 1
3. If and only if Steps 1-2 yielded nothing: Leave blank or set to "N/A" / empty array

**For effectiveDateAdjustmentBusinessDayConvention and Business Centers:**
1. Check Effective Date field for explicit business day convention AND business centers → **IF FOUND: USE THEM AND STOP. DO NOT CHECK STEP 2.**
2. If and only if Step 1 yielded nothing: Use general Business Day Convention and Business Centers from Step 1  
3. If and only if Steps 1-2 yielded nothing: Leave blank or set to "N/A" / empty array

**For terminationDateAdjustmentBusinessDayConvention and Business Centers:**
1. Check Termination Date field for explicit business day convention AND business centers → **IF FOUND: USE THEM AND STOP. DO NOT CHECK STEPS 2-3.**
2. If and only if Step 1 yielded nothing: Check Period End Dates sections for each leg
3. If and only if Steps 1-2 yielded nothing: Use general Business Day Convention and Business Centers from Step 1
4. If and only if Steps 1-3 yielded nothing: Leave blank or set to "N/A" / empty array

**For leg-level effective and termination date conventions and business centers:**
1. Look for leg-specific business day conventions and business centers in each leg's documentation
2. If not found, inherit from header-level equivalent field
3. Cross-validate that both legs have consistent conventions and business centers where logical

## Business Center Extraction Rules

**Multiple Business Centers**: 
- Parse comma-separated or space-separated lists: "NYC, SAN" → ["USNY", "CLSA"]
- Handle various separators: "Nueva York-Santiago" → ["USNY", "CLSA"]
- Convert all variations to standardized enum values using pattern mapping
- Always output as array even for single business center

**Business Center Inheritance**:
- If leg-level business centers not specified, inherit from header-level
- If header-level not specified, check general business center definitions
- Empty array if no business centers can be determined

**Payment Dates Business Centers**:
- **English contracts**: Look for "Business Day for all other purposes" or specific payment date field labels
- **Spanish contracts**: Look for "Calendario de Pago" sections
- Ignore contingent provisions (e.g., "provided however, that in the event of an Unscheduled Holiday following the Trade Date, then New York only") and extract only the regular business centers

**Period End Dates Business Centers**:
- Use the same sources as trade/effective/termination dates
- **English contracts**: Business day fields for valuation dates  
- **Spanish contracts**: "Calendario de Cálculo" sections

## Validation and Quality Checks

**Prohibited Extraction Sources - DO NOT use these sections:**
- Payment instructions or settlement procedures
- Calculation methodology sections  
- Notice periods or communication procedures
- "Adjustment to Payment Dates and Exchange Dates" sections
- Any section that mentions "business days" without specifying "business day convention"
- **CRITICAL**: Period End Dates sections if you already found a valid convention in the primary date field
- **CRITICAL**: Floating Rate Payer sections if you already found a valid convention in the primary date field

**Confidence Assessment:**
- Set "Clear" boolean to `true` if the convention is explicitly stated in the primary field (Step 1 for any field)
- Set "Clear" boolean to `false` if:
  - The value comes from fallback rules (Steps 2+ for any field)
  - Multiple conflicting conventions are found
  - The value comes from a default rule
  - Any ambiguity exists in the source text
  - **The value was inherited from leg-level conventions for header-level fields**

**Cross-Validation Rules:**
- If both legs specify different conventions for the same date type, flag as potentially ambiguous (Clear = false)
- Verify extracted values are valid enums: MODFOLLOWING, FOLLOWING, PRECEDING, or NONE
- Ensure leg-level conventions are logically consistent with header-level conventions

## Output Requirements

### Primary JSON Format:
```json
{
    "header": {
        "tradeDate": {
            "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]",
            "tradeDateBusinessDayConventionClear": "[true|false]",
            "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
            "tradeDateBusinessCentersClear": "[true|false]"
        },
        "effectiveDate": {
            "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]", 
            "effectiveDateBusinessDayConventionClear": "[true|false]",
            "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
            "effectiveDateBusinessCentersClear": "[true|false]"
        },
        "terminationDate": {
            "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]",
            "terminationDateBusinessDayConventionClear": "[true|false]",
            "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
            "terminationDateBusinessCentersClear": "[true|false]"
        }
    },
    "legs": [
        {
            "effectiveDate": {
                "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]",
                "effectiveDateBusinessDayConventionClear": "[true|false]",
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "effectiveDateBusinessCentersClear": "[true|false]"
            },
            "terminationDate": {
                "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]",
                "terminationDateBusinessDayConventionClear": "[true|false]",
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "terminationDateBusinessCentersClear": "[true|false]"
            },
            "paymentDates": {
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "paymentDatesBusinessCentersClear": "[true|false]"
            },
            "periodEndDates": {
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "periodEndDatesBusinessCentersClear": "[true|false]"
            }
        },
        {
            "effectiveDate": {
                "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]",
                "effectiveDateBusinessDayConventionClear": "[true|false]",
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "effectiveDateBusinessCentersClear": "[true|false]"
            },
            "terminationDate": {
                "businessDayConvention": "[MODFOLLOWING|FOLLOWING|PRECEDING|NONE]",
                "terminationDateBusinessDayConventionClear": "[true|false]",
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "terminationDateBusinessCentersClear": "[true|false]"
            },
            "paymentDates": {
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "paymentDatesBusinessCentersClear": "[true|false]"
            },
            "periodEndDates": {
                "businessCenters": ["[USNY|CLSA|USGS|GBLO|JPTO|EUTA|CATO|AUSY|HKHK|CHZU]"],
                "periodEndDatesBusinessCentersClear": "[true|false]"
            }
        }
    ]
}
```

### Secondary JSON Format:
Use the same structure but populate each field with the exact contract text snippet used to make the extraction decision. For fields where no specific text was found and default values were used, write: "No specific convention found - used default value"

## Processing Guidelines

**Strict Adherence:**
- Only extract from sections that explicitly mention business day conventions
- Do not guess or infer beyond the specified fallback rules
- If unsure, use the default value and mark Clear as false
- Maintain zero tolerance for extracting from incorrect contract sections

**Error Handling:**
- If contract text is incomplete or corrupted, mark affected fields as unclear (Clear = false)
- If external references are mentioned (e.g., "As per ISDA definitions"), note this in secondary JSON but do not attempt to resolve
- Handle cases where legs have different structures or naming conventions

**Final Validation:**
Before outputting JSON, verify:
- All enum values are spelled correctly and match exactly: MODFOLLOWING, FOLLOWING, PRECEDING, NONE
- All Clear boolean fields contain only `true` or `false`
- JSON structure matches the required schema exactly
- Secondary JSON provides meaningful source attribution for each extracted value

### Contract Text:

{contract_text}